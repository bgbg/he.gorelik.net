---
title: "תרשים עוגה כחלופה הולמת לגרף עמודות"
date: 2020-02-02
categories: 
 - "בלוג"
 - "הדמיית-נתונים"
tags: 
 - "תרשים-עוגה"
 - "תרשים-עמודות"
cover_image: "/assets/img/2020/02/featured_pie.png"
layout: "post"
---

תרשים עוגה כחלופה הולמת לגרף עמודות

במהלך חיי המקצועיים שמעתי רבות בגנות תרשימי עוגה. הסיבה לכך נעוצה בעובדה שקל מאוד לייצר זוועות עם תרשימים אלו. לא עזרה העובדה שבמשך המון זמן ברירת המחדל של תרשימי עוגה, בכל כלי ההדמיה העיקריים, ייצרה תרשימים מעוותים לגמרי. מצדדי החרם על תרשים עוגה מציעים את גרף העמודות כחלופה ראשונה. יחד עם זאת צריך לזכור שלא מתקנים עוול אחד בעוול אחר. לפעמים גרף עוגה דווקא מתאים יותר מגרף העמודות. בואו נראה דוגמה למקרה כזה.

הכנסת המתפקדת האחרונה שהייתה לנו במדינת ישראל הייתה [הכנסת ה־20](https://he.wikipedia.org/wiki/%D7%94%D7%9B%D7%A0%D7%A1%D7%AA_%D7%94%D7%A2%D7%A9%D7%A8%D7%99%D7%9D). בואו נראה איך התפלגו מושבי הכנסת בין המפלגות השונות.

זה הקוד ליצירת תרשים עוגה בסיסי בשפת פייתון עם שימוב בספריות סטנדרטיות

    fig, ax = plt.subplots()
    ax.pie(
        x=tbl_knesset20['מושבים'],
        labels=tbl_knesset20['מפלגה']
    )

עד לא מזמן, התוצאה הייתה נראית ככה:

![]({{ site.baseurl }}/assets/img/2020/02/image.png){:width="216"}*
*

עזבו לרגע את העברית ההפוכה (נטפל בזה בהמשך), הגרף הזה פשוט נורא. הבעיה הגדולה ביותר שלו זה עווית המציאות. כאשר אנחנו מסתכלים על תרשים עוגה, אנחנו אומדים (estimate) שטחים וזוויות. במקרה הזה, יחס גובה/רוחב של העיגול לא נשמר ואתו גם נהרסו השטחים והזוויות. מה עושים?  ספריית matplotlib  מאפשרת קיבוע של יחס גובה/רוחב על ידי ax.set_aspect(1.0) . לשמחתי, גרסאות חדשות של ספריה זו הכניסו את היחס הנכון כברירת מחדל והעוגה הדפולטיבית נראית עגולה היום. ברוך ה׳

![]({{ site.baseurl }}/assets/img/2020/02/image-1.png){:width="166"}*
*

לפני שנפתור את הבעיות הגדולות יותר, בואו נטפל בעברית. כל מה שצריך לעשות זה להתקי[ן ספריה מתאימה](https://pypi.org/project/python-bidi/).

    fig, ax = plt.subplots()
    ax.set_aspect(1.0)
    patches, texts = ax.pie(
        x=tbl_knesset20['מושבים'],
    )
    ax.legend(patches, tbl_knesset20['label'])
    ax.set_title(bidialg.get_display('לא לנסות בבית'))

![]({{ site.baseurl }}/assets/img/2020/02/image-2.png){:width="116"}

עדיין לא טוב. מרוב עצים לא רואים את היער. האם הצופה יכול לראות כמה מושבים יש לש״ס, למשל? או לליכוד?

ניסיון להזיז את המקרא ולהוסיף מספרים עדיין לא עובד טוב

![]({{ site.baseurl }}/assets/img/2020/02/image-3.png){:width="193"}

![]({{ site.baseurl }}/assets/img/2020/02/image-4.png){:width="166"}

בנקודה הזאת, האדם הסביר שלמד הדמית נתונים מרים ידיים, נזכר בתרשימי עמודות ומייצר משהו נחמד

![]({{ site.baseurl }}/assets/img/2020/02/image-6.png){:width="913"}

זה יותר טוב, אבל לא מצויין. למה לא? כי אם כל מה שאנחנו רוצים להגיד זה כמה מושבים יש לכל מפלגה, לא צריך גרף, טבלה יכולה להספיק. אבל אם אנחנו רוצים להציג את מאזן הכוחות בכנסת הזאת, הגרף הזה לא מספק את הסחורה בכלל. למעשה, אין לנו כאן עשר מפלגות, אלא שתי קבוצות של מפלגות – הקואליציה והאופוזיציה (זוכרים כמה משעמם היה פעם). ואם מה שמעניין אותנו זה מאזן בין שתי קבוצות, אז גרף עוגה יכול להיות בחירה טובה.

לפני שנמשיך, להלן כללי אצבע לתרשים עוגה טוב אותם ליקטתי בספרות

* מעט מאוד קבוצות (הייתי אומר, עד 4)
* הפלחים ממוינים. המיון מקל על ההשוואה
* עיגול צריך להראות עיגול (יחס גובה/רוחב שווה ל־1(
* זהו

״רגע!״ אתם וודאי צועקים, לא אמרת מעט קבוצות?  ״כן,״ אני עונה – כאן יש שתי קבוצות: קואליציה ואופוזיציה. בואו נצבע את הפלחים בהתאם

![]({{ site.baseurl }}/assets/img/2020/02/image-7.png){:width="668"}

אנחנו מתקרבים. בנקודה זאת אני קצת מרמה. אני רוצה לקבץ את כל מפלגות הקואליציה ביחד, ואת האופוזיציה ביחד. טכנית, כדי לבצע את הקיבוץ הזה, אני הכפלתי את מספר המושבים של הקואליציה במינוס אחד, והתוצאה לפנינו:

![]({{ site.baseurl }}/assets/img/2020/02/image-8.png){:width="612"}

![]({{ site.baseurl }}/assets/img/2020/02/image-9.png){:width="636"}

נו, תגידו אתם, מה יותר טוב?

![]({{ site.baseurl }}/assets/img/2020/02/image-9.png)

![]({{ site.baseurl }}/assets/img/2020/02/image-6.png)

אני טוען שבמקרה הזה העוגה עדיפה על המקלות.

מי שמעוניין לראות את קוד הפייתון אתו יצרתי את הגרפים האלה, מומן להגיע [לרפוזיטורי שלי בגיטהאב](https://github.com/bgbg/datascience_dataviz_workshop), בו יש עוד הרבה דוגמאות מעניינות..

להלן חוברת העבודה הרלוונטית

<https://github.com/bgbg/datascience_dataviz_workshop/blob/master/demos/item_distribution/pie%20charts%20as%20an%20alternative%20to%20bar%20charts%20-%20the%20Israeli%20Knesset.ipynb>
